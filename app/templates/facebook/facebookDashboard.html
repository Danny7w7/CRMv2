{% extends "dashboard/index.html" %}
{% load static %}
{% block head %}
    <title>Dashboard Facebook - CRM</title>
	<!--plugins-->
	<link href="{% static "assets/plugins/simplebar/css/simplebar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/metismenu/css/metisMenu.min.css" %}" rel="stylesheet" />
	<!-- loader-->
	<link href="{% static "assets/css/pace.min.css" %}" rel="stylesheet" />
	<script src="{% static "assets/js/pace.min.js" %}"></script>
	<!-- Bootstrap CSS -->
	<link href="{% static "assets/css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/bootstrap-extended.css" %}" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
	<link href="{% static "assets/css/app.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/icons.css" %}" rel="stylesheet">
	<!-- Theme Style CSS -->
	<link rel="stylesheet" href="{% static "assets/css/dark-theme.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/semi-dark.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/header-colors.css" %}" />
	
	<style>
		.fb-icon-badge {
			width: 45px;
			height: 45px;
			background: linear-gradient(135deg, #1877f2 0%, #0c5bce 100%);
			border-radius: 10px;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
			color: white;
			margin-right: 10px;
		}
		
		.stat-card {
			transition: transform 0.3s, box-shadow 0.3s;
		}
		
		.stat-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 20px rgba(0,0,0,0.1);
		}
		
		.account-card {
			transition: all 0.3s;
			border-left: 4px solid transparent;
		}
		
		.account-card:hover {
			border-left-color: #1877f2;
			transform: translateX(5px);
		}
		
		.status-badge {
			font-size: 12px;
			padding: 5px 12px;
			border-radius: 20px;
		}
		
		.empty-state {
			padding: 60px 20px;
			text-align: center;
		}
		
		.empty-state-icon {
			font-size: 64px;
			opacity: 0.3;
			margin-bottom: 20px;
		}
	</style>
{% endblock %}

{% block page_content %}
<!-- Mensajes de Django -->
{% if messages %}
<div class="row">
	<div class="col-12">
		{% for message in messages %}
		<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
			<i class='bx {% if message.tags == "success" %}bx-check-circle{% elif message.tags == "error" %}bx-x-circle{% else %}bx-info-circle{% endif %} me-2'></i>
			{{ message }}
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		{% endfor %}
	</div>
</div>
{% endif %}

<!-- Header -->
<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
    
	<div class="breadcrumb-title pe-3">
		<span class="fb-icon-badge">f</span>
		Facebook
	</div>
 
	<div class="ms-auto">
		<div class="btn-group">
			<a href="/facebook/leads/" class="btn btn-secondary">
				<i class='bx bx-list-ul'></i> Ver Leads
			</a>
			<a href="/facebook/connect/" class="btn btn-primary">
				<i class='bx bx-plus'></i> Conectar Página
			</a>
		</div>
	</div>
</div>

<br>

<h6 class="mb-0 text-uppercase">Estadísticas de Facebook</h6>
<hr/>

<!-- Estadísticas -->
<div class="row row-cols-1 row-cols-md-2 row-cols-xl-4">
    
	<div class="col">
		<div class="card radius-10 stat-card">
			<div class="card-body">
				<div class="d-flex align-items-center">
					<div>
						<p class="mb-0 text-secondary">Total Leads</p>
						<h4 class="my-1 text-primary">{{ total_leads|default:0 }}</h4>
					</div>
					<div class="widgets-icons bg-light-primary text-primary ms-auto">
						<i class='bx bxs-group'></i>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="col">
		<div class="card radius-10 stat-card">
			<div class="card-body">
				<div class="d-flex align-items-center">
					<div>
						<p class="mb-0 text-secondary">Leads Hoy</p>
						<h4 class="my-1 text-success">{{ leads_today|default:0 }}</h4>
					</div>
					<div class="widgets-icons bg-light-success text-success ms-auto">
						<i class='bx bxs-calendar-check'></i>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="col">
		<div class="card radius-10 stat-card">
			<div class="card-body">
				<div class="d-flex align-items-center">
					<div>
						<p class="mb-0 text-secondary">Pendientes</p>
						<h4 class="my-1 text-warning">{{ leads_pending|default:0 }}</h4>
					</div>
					<div class="widgets-icons bg-light-warning text-warning ms-auto">
						<i class='bx bxs-time'></i>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="col">
		<div class="card radius-10 stat-card">
			<div class="card-body">
				<div class="d-flex align-items-center">
					<div>
						<p class="mb-0 text-secondary">Páginas Conectadas</p>
						<h4 class="my-1 text-info">{{ total_accounts|default:0 }}</h4>
					</div>
					<div class="widgets-icons bg-light-info text-info ms-auto">
						<i class='bx bxl-facebook-circle'></i>
					</div>
				</div>
			</div>
		</div>
	</div>

</div>

<!-- Lista de páginas conectadas -->
<h6 class="mb-0 text-uppercase">Páginas Conectadas</h6>
<hr/>

<div class="card">
	<div class="card-body">
		{% if facebook_accounts %}
			<div class="table-responsive">
				<table class="table table-hover mb-0">
					<thead>
						<tr>
							<th>Página</th>
							<th>Propietario</th>
							<th class="text-center">Total Leads</th>
							<th class="text-center">Nuevos</th>
							<th class="text-center">Estado</th>
							<th class="text-center">Acciones</th>
						</tr>
					</thead>
					<tbody>
						{% for account in facebook_accounts %}
						<tr class="account-card">
							<td>
								<div class="d-flex align-items-center">
									<div class="fb-icon-badge" style="width: 35px; height: 35px; font-size: 18px; margin-right: 10px;">
										f
									</div>
									<div>
										<h6 class="mb-0">{{ account.page_name }}</h6>
									</div>
								</div>
							</td>
							<td>{{ account.owner_name }}</td>
							<td class="text-center">
								<span class="badge bg-primary rounded-pill">{{ account.total_leads|default:0 }}</span>
							</td>
							<td class="text-center">
								<span class="badge bg-warning rounded-pill">{{ account.unprocessed_leads|default:0 }}</span>
							</td>
							<td class="text-center">
								<span class="badge bg-success status-badge">
									<i class='bx bx-check'></i> Activa
								</span>
							</td>
							<td class="text-center">
								<div class="d-flex justify-content-center gap-2">
									<a href="/facebook/account/{{ account.id }}/" class="btn btn-sm btn-primary">
										<i class='bx bx-show'></i> Ver
									</a>
								</div>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% else %}
			<div class="empty-state">
				<div class="empty-state-icon">
					<i class='bx bxl-facebook-circle'></i>
				</div>
				<h4 class="text-secondary">No hay páginas conectadas</h4>
				<p class="text-muted">Conecta tu primera página de Facebook para empezar a recibir leads</p>
				<a href="/facebook/connect/" class="btn btn-primary mt-3">
					<i class='bx bx-plus'></i> Conectar ahora
				</a>
			</div>
		{% endif %}
	</div>
</div>

{% endblock %}

{% block end_js %}
	<!-- Bootstrap JS -->
	<script src="{% static "assets/js/bootstrap.bundle.min.js" %}"></script>
	<!--plugins-->
	<script src="{% static "assets/js/jquery.min.js" %}"></script>
	<script src="{% static "assets/plugins/simplebar/js/simplebar.min.js" %}"></script>
	<script src="{% static "assets/plugins/metismenu/js/metisMenu.min.js" %}"></script>
	<script src="{% static "assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js" %}"></script>
	<!--app JS-->
	<script src="{% static "assets/js/app.js" %}"></script>

	<script>
		// Auto-ocultar mensajes después de 5 segundos
		setTimeout(() => {
			const alerts = document.querySelectorAll('.alert');
			alerts.forEach(alert => {
				const bsAlert = new bootstrap.Alert(alert);
				bsAlert.close();
			});
		}, 5000);
	</script>
{% endblock %}