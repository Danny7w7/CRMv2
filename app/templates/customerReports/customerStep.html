{% extends "dashboard/index.html" %}
{% load static %}
{% block head %}
    <title>8 Step</title>
	<!--plugins-->
	<link href="{% static "assets/plugins/simplebar/css/simplebar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/metismenu/css/metisMenu.min.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/datatable/css/dataTables.bootstrap5.min.css" %}" rel="stylesheet" />
	<!-- loader-->
	<link href="{% static "assets/css/pace.min.css" %}" rel="stylesheet" />
	<script src="{% static "assets/js/pace.min.js" %}"></script>
	<!-- Bootstrap CSS -->
	<link href="{% static "assets/css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/bootstrap-extended.css" %}" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
	<link href="{% static "assets/css/app.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/icons.css" %}" rel="stylesheet">
	<!-- Theme Style CSS -->
	<link rel="stylesheet" href="{% static "assets/css/dark-theme.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/semi-dark.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/header-colors.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/mixSales.css" %}" />

{% endblock %}
{% block page_content %}

<h4 class="mb-0 text-uppercase">8 Step</h4>

<hr/>

<div class="card">
	<div class="card-body">
		<div id="charts-wrapper">

			<form method="POST" class="row">
				{% csrf_token %}
				<div class="col-md-3">
					<label for="start_date">Start date:</label>
					<input type="date" required name="start_date" id="start_date" class="form-control" value="{{ startDate }}">
				</div>
				<div class="col-md-3">
					<label for="end_date">End date:</label>
					<input type="date" required name="end_date" id="end_date" class="form-control" value="{{ endDate }}">
				</div>
				<div class="col-md-3">
					<label for="end_date">Agent:</label>
					<select  class="form-select" name="agent" id="agent">
						<option disabled selected>Please Select</option>
						{% for item in agent %}
							<option {% if item == agentPost %}selected{% endif %} value="{{item}}">{{item}}</option>
						{% endfor %}
					</select>
				</div>
				<div class="col-md-3 align-self-end mt-2">
					<button type="submit" class="btn btn-primary">Filter</button>
					<a href="{% url 'customerStep' %}" class="btn btn-secondary">Reset</a>
				</div>
			</form>
			
		</div>
    </div>
</div>

<hr/>

<div class="card">
    <div class="card-body">
		<div id="charts-wrapper">
			<div class="table-responsive">
				<table id="tableTypification" width="100%" cellspacing="0" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>Agente Col</th>
							<th>Name Client</th>
							<th>Agent USA</th>
							<th>Carrire</th>
							<th>Date</th>
							<th>Status</th>
							<th>Policy Numbers</th>
							<th>Letters</th>
							<th>Card</th>
							<th>Appointments</th>
							<th>User Carrier</th>
							<th>Payment Date</th>
							<th>Documents</th>
						</tr>
					</thead>
					<tbody>
						{% for item in obama %}
						<tr>
							<td>{{ item.profiling }}</td>
							<td>{{ item.client.first_name }} {{ item.client.last_name }}</td>
							<td>{{ item.agent_usa }}</td>
							<td>{{ item.carrier }}</td>
							<td>{{ item.created_at|date:"m-d-Y"}}</td>
							<td>{{ item.status }}</td>
							<td>{{ item.policyNumber }}</td>
							
							<!-- Solo el primer registro de cada relación -->
							{% if item.letterscard_set.first.letters %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}

							{% if item.letterscard_set.first.card %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}

							{% if item.appointmentclient_set.first.created_at %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}
							
							{% if item.usercarrier_set.first.password_carrier %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}

							{% if item.paymentdate_set.first.payment_date %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}

							{% if item.documentobamasupp_set.first.created_at %}
								<td> ✅ </td>
							{% else %}
								<td> ❔ </td>
							{% endif %}

						</tr>
						{% empty %}
						<tr>
							<td colspan="12" class="text-center">No hay datos disponibles</td>
						</tr>
						{% endfor %}
					</tbody>

					
				</table>
			</div>
		</div>
    </div>
</div>


{% endblock %}
{% block end_js %}
	<!-- Bootstrap JS -->
	<script src="{% static "assets/js/bootstrap.bundle.min.js" %}"></script>
	<!--plugins-->
	<script src="{% static "assets/js/jquery.min.js" %}"></script>
	<script src="{% static "assets/plugins/simplebar/js/simplebar.min.js" %}"></script>
	<script src="{% static "assets/plugins/metismenu/js/metisMenu.min.js" %}"></script>
	<script src="{% static "assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/jquery.dataTables.min.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/dataTables.bootstrap5.min.js" %}"></script>
	<script src="{% static "assets/plugins/apexcharts-bundle/js/apexcharts.min.js" %}"></script>
	<script src="{% static "assets/plugins/apexcharts-bundle/js/apex-custom.js" %}"></script>

	<!--app JS-->
	<script src="{% static 'assets/js/app.js' %}"></script>

	<script>	
		$(document).ready(function() {
			var table = $('#tableTypification').DataTable( {
				lengthChange: false,
				buttons: [ 'excel',  'print']
			} );
		 
			table.buttons().container()
				.appendTo( '#tableTypification_wrapper .col-md-6:eq(0)' );
		} );
	</script>

{% endblock %}