{% extends "dashboard/index.html" %}
{% load static %}
{% block head %}
    <title>Table BD</title>
	<!--plugins-->
	<link href="{% static "assets/plugins/simplebar/css/simplebar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/metismenu/css/metisMenu.min.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/datatable/css/dataTables.bootstrap5.min.css" %}" rel="stylesheet" />
	<!-- loader-->
	<link href="{% static "assets/css/pace.min.css" %}" rel="stylesheet" />
	<script src="{% static "assets/js/pace.min.js" %}"></script>
	<!-- Bootstrap CSS -->
	<link href="{% static "assets/css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/bootstrap-extended.css" %}" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
	<link href="{% static "assets/css/app.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/icons.css" %}" rel="stylesheet">
	<!-- Theme Style CSS -->
	<link rel="stylesheet" href="{% static "assets/css/dark-theme.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/semi-dark.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/header-colors.css" %}" />
{% endblock %}
{% block page_content %}
<h6 class="mb-0 text-uppercase">BD assigned</h6>

<hr/>
{% if request.user.is_superuser%}
    <div class="card">
        <div class="card-header">
            <form method="POST" class="row">
                {% csrf_token %}
                <div class="col-md-3">
                    <label for="Name BD">Name BD:</label>
                    <select class="form-select" name="bd" id="bd" required>
                        <option value="" disabled selected>Select Please</option>
                            {% for bd_item in bdName %}
                                <option value="{{ bd_item.id }}" {% if filter and filter == bd_item.id|stringformat:"s" %}selected{% endif %}>
                                    {{ bd_item.file_name }}
                                </option>
                            {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 align-self-end mt-2">
                    <button type="submit" class="btn btn-primary">Filter</button>
                    <a href="{% url 'bd' %}" class="btn btn-secondary">Reset</a>
                </div>
            </form>
        </div>
    </div>
    <hr/>
{% endif %}

<div class="card">

    <div class="card-body">

        <!-- Controles de búsqueda y paginación -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label>Show 
                    <select id="recordsPerPage" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                    records
                </label>
            </div>
            <div class="col-md-6 text-end">
                <label>Search: 
                    <input type="text" id="searchInput" class="form-control form-control-sm" style="width: 200px; display: inline-block;" placeholder="Search...">
                </label>
            </div>
        </div>

        <div class="table-responsive">
            <table id="tableClient" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        {% if request.user.role == 'Admin' or request.user.role == 'S'%}
                            <th>Sold</th>
                        {% endif %}
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>City</th>
                        <th>State</th>
                        <th>Other Information</th>
                        <th>Typification</th>
                        <th>View Typification</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="11" class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Información y paginación -->
        <div class="row mt-3">
            <div class="col-md-6">
                <div id="tableInfo"></div>
            </div>
            <div class="col-md-6">
                <nav>
                    <ul class="pagination justify-content-end" id="pagination"></ul>
                </nav>
            </div>
        </div>

    </div>

</div>

<!-- Modal para "Other Information" -->
<div class="modal fade" id="modalOther" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Additional details (Other)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" id="modalOtherBody">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>
</div>

<!-- Modal para ver tipificaciones/comentarios -->
<div class="modal fade" id="modalVerTexto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Comments / Classifications</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" id="modalVerTextoBody">
                <div class="text-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Escribir Observación -->
<div class="modal fade" id="modalObservation" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <textarea id="obsInput" class="form-control" rows="4"></textarea>
                <input type="hidden" id="obsRecordId">
                <input type="hidden" id="obsExcelId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-success" id="btnSaveObs">Save</button>
            </div>
        </div>
    </div>
</div>

<div id="bdTableContainer" 
    data-is-admin="{% if request.user.role == 'Admin' or request.user.role == 'S' %}true{% else %}false{% endif %}"
    data-bd-filter="{{ filter|default:'' }}"
    data-api-url="{% url 'bd' %}">
    {% csrf_token %}
</div>

<!-- Pasar las opciones del dropdown como variable global -->
<script>
    window.BD_OPTIONS = [
        {% for option in optionBd %}
            "{{ option }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
</script>

{% endblock %}
{% block end_js %}
	<!-- Bootstrap JS -->
	<script src="{% static "assets/js/bootstrap.bundle.min.js" %}"></script>
	<!--plugins-->
	<script src="{% static "assets/js/jquery.min.js" %}"></script>
	<script src="{% static "assets/plugins/simplebar/js/simplebar.min.js" %}"></script>
	<script src="{% static "assets/plugins/metismenu/js/metisMenu.min.js" %}"></script>
	<script src="{% static "assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/jquery.dataTables.min.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/dataTables.bootstrap5.min.js" %}"></script>
	<script>
        $(document).ready(function() {$('#tableClient').DataTable();} );
	</script>
	<!--app JS-->
	<script src="{% static "assets/js/app.js" %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static "assets/js/bdExcel/fetch.js" %}"></script>  

{% endblock %}
