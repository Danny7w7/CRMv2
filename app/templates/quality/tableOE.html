{% extends "dashboard/index.html" %}
{% load static %}
{% block head %}
    <title>Table Sale</title>
	<!--plugins-->
	<link href="{% static "assets/plugins/simplebar/css/simplebar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/metismenu/css/metisMenu.min.css" %}" rel="stylesheet" />
	<link href="{% static "assets/plugins/datatable/css/dataTables.bootstrap5.min.css" %}" rel="stylesheet" />
	<!-- loader-->
	<link href="{% static "assets/css/pace.min.css" %}" rel="stylesheet" />
	<script src="{% static "assets/js/pace.min.js" %}"></script>
	<!-- Bootstrap CSS -->
	<link href="{% static "assets/css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/bootstrap-extended.css" %}" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
	<link href="{% static "assets/css/app.css" %}" rel="stylesheet">
	<link href="{% static "assets/css/icons.css" %}" rel="stylesheet">
	<!-- Theme Style CSS -->
	<link rel="stylesheet" href="{% static "assets/css/dark-theme.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/semi-dark.css" %}" />
	<link rel="stylesheet" href="{% static "assets/css/header-colors.css" %}" />
{% endblock %}
{% block page_content %}
<h6 class="mb-0 text-uppercase">Errors/Omissions</h6>
<hr/>

<h4>Filter Data</h4>
<div class="card">
    <div class="card-header">
        <form method="POST" class="row">
            <div class="col-md-4">
				<label for="start_date">Start date:</label>
				<input type="date" name="start_date" id="start_date" class="form-control" value="{{ start_date }}" required>
            </div>
            <div class="col-md-4">
                <label for="end_date">End date: </label>
                <input type="date" name="end_date" id="end_date" class="form-control" value="{{ end_date}}" required>
            </div>
            <div class="col-md-4 align-self-end">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="{% url 'tableOE' %}" class="btn btn-secondary">Reset</a>
            </div>
			<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
			{% csrf_token %}
        </form>
    </div>
</div>
<hr>

<h4>All Errors/Omissions</h4>

<div class="col">
	<div class="card mb-3">
		<div class="card-body">
			<div class="table-responsive">
				<table id="eo" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>Agent</th>
							<th>Question</th>
							<th>Typification</th>
							<th>Company</th>								
							<th>Total</th>
						</tr>
					</thead>
					<tbody>
						{% for row in eo %}
						<tr>
							<td>
								<a href="#" class="agent-link" data-agent-id="{{ row.agent_id }}">
									{{ row.agent__first_name }} {{ row.agent__last_name }}
								</a>
							</td>
							<td>{{ row.eoID__errores_omision }}</td>
							<td>{{ row.eo }}</td>
							{% if request.user.is_superuser %}							
								<td>{{ row.Company_name }}</td>
							{% endif %}
							<td>{{ row.total }}</td>
						{% empty %}
						<tr>
							<td colspan="11" class="text-center">No hay registros en este rango.</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<!--modal-->
<div class="modal fade" id="agentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle del Agente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Pregunta</th>
              <th>Respuesta</th>
              <th>Cliente</th>
            </tr>
          </thead>
          <tbody id="agentModalBody">
            <tr><td colspan="5" class="text-center">Cargando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


{% endblock %}
{% block end_js %}
	<!-- Bootstrap JS -->
	<script src="{% static "assets/js/bootstrap.bundle.min.js" %}"></script>
	<!--plugins-->
	<script src="{% static "assets/js/jquery.min.js" %}"></script>
	<script src="{% static "assets/plugins/simplebar/js/simplebar.min.js" %}"></script>
	<script src="{% static "assets/plugins/metismenu/js/metisMenu.min.js" %}"></script>
	<script src="{% static "assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/jquery.dataTables.min.js" %}"></script>
	<script src="{% static "assets/plugins/datatable/js/dataTables.bootstrap5.min.js" %}"></script>

	<script>
		$(document).ready(function() {
			var table = $('#eo').DataTable( {
				lengthChange: false,
				buttons: [ 'copy', 'excel', 'pdf', 'print']
			} );
		 
			table.buttons().container()
				.appendTo( '#eo_wrapper .col-md-6:eq(0)' );
		} );
	</script>
	
	<!--app JS-->
	<script src="{% static "assets/js/app.js" %}"></script>
	<script src="{% static "assets/js/modals/tableOE.js" %}"></script>	

{% endblock %}